local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer

local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")
local torso = character:WaitForChild("Torso")

-- Settings
local tailLength = 4
local baseSize = Vector3.new(0.4, 0.4, 0.8)
local tailParts = {}
local segmentOffset = 1.2 -- distance between each segment
local rainbowColors = {
	Color3.fromRGB(255, 0, 0),
	Color3.fromRGB(255, 128, 0),
	Color3.fromRGB(255, 255, 0),
	Color3.fromRGB(0, 255, 0),
	Color3.fromRGB(0, 255, 255),
	Color3.fromRGB(0, 128, 255),
	Color3.fromRGB(128, 0, 255),
}

-- Cleanup if tail already exists
if character:FindFirstChild("CoolTail") then
	character.CoolTail:Destroy()
end

local model = Instance.new("Model")
model.Name = "CoolTail"
model.Parent = character

-- Create tail segments
for i = 1, tailLength do
	local part = Instance.new("Part")
	local scale = 1 + (i * 0.3)
	part.Size = baseSize * Vector3.new(scale, scale, 1.2)
	part.Material = Enum.Material.Neon
	part.Anchored = false
	part.CanCollide = false
	part.CastShadow = false
	part.Color = rainbowColors[(i - 1) % #rainbowColors + 1]
	part.Name = "TailPart"..i
	part.Parent = model
	tailParts[i] = part
end

-- Create spinning cube at the end
local cube = Instance.new("Part")
cube.Size = Vector3.new(1.5, 1.5, 1.5)
cube.Material = Enum.Material.Neon
cube.Anchored = false
cube.CanCollide = false
cube.CastShadow = false
cube.Color = Color3.fromRGB(255, 255, 255)
cube.Shape = Enum.PartType.Block
cube.Name = "TailEndCube"
cube.Parent = model

-- Weld all tail parts together
local function weldBetween(a, b)
	local weld = Instance.new("Motor6D")
	weld.Part0 = a
	weld.Part1 = b
	weld.C0 = CFrame.new(0, 0, -segmentOffset)
	weld.Parent = a
	return weld
end

-- Attach root to torso
local rootWeld = Instance.new("Motor6D")
rootWeld.Part0 = torso
rootWeld.Part1 = tailParts[1]
rootWeld.C0 = CFrame.new(0, -0.5, 1.5) -- waist back
rootWeld.Parent = torso

for i = 2, #tailParts do
	weldBetween(tailParts[i - 1], tailParts[i])
end
weldBetween(tailParts[#tailParts], cube)

-- Wobble motion and cube spin
local timeOffset = math.random() * math.pi
RunService.RenderStepped:Connect(function(dt)
	local t = tick() + timeOffset

	for i, part in ipairs(tailParts) do
		local sway = math.sin(t * 2 + i * 0.5) * 10
		part.Motor6D.C1 = CFrame.Angles(math.rad(sway), 0, 0)
	end

	-- Cube spin and wobble
	local cubeSway = math.sin(t * 4) * 25
	local cubeSpin = CFrame.Angles(math.rad(cubeSway), math.rad(t * 120), 0)
	cube.Motor6D.C1 = cubeSpin
end)
