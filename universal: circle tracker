local RunService = game:GetService("RunService")
local Players = game:GetService("Players")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local torso = character:WaitForChild("Torso")

-- Settings
local SEGMENTS = 14
local SPACING = 0.8
local tailParts = {}
local rainbowColors = {}

for i = 0, 360, 30 do
	table.insert(rainbowColors, Color3.fromHSV(i / 360, 1, 1))
end

-- Remove old tail
local old = character:FindFirstChild("RainbowTail")
if old then old:Destroy() end

-- Tail folder
local tailFolder = Instance.new("Folder")
tailFolder.Name = "RainbowTail"
tailFolder.Parent = character

-- Create segments
local lastPos = torso.Position
for i = 1, SEGMENTS do
	local part = Instance.new("Part")
	part.Size = Vector3.new(0.6, 0.6, 0.6)
	part.Anchored = true
	part.CanCollide = false
	part.Material = Enum.Material.Neon
	part.Color = rainbowColors[(i * 3) % #rainbowColors + 1]
	part.CFrame = torso.CFrame * CFrame.new(0, 0, i * SPACING)
	part.Parent = tailFolder
	table.insert(tailParts, {
		Part = part,
		Position = part.Position
	})
end

-- Update tail visually
RunService.RenderStepped:Connect(function(dt)
	local targetPos = torso.Position
	local last = targetPos
	for i, segment in ipairs(tailParts) do
		local t = 0.15 + i * 0.02 -- looser at the tip
		local seg = segment
		seg.Position = seg.Position:Lerp(last - (torso.CFrame.LookVector * SPACING), t)
		seg.Part.CFrame = CFrame.new(seg.Position)
		last = seg.Position
	end
end)
